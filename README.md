# Toothless - сайт стоматологической клиники

### Семестровая работа на стэке:
- Spring Boot 3.4.5 + Security
- Vue Js 3
- Postgres + MiniO + Redis
- Docker
- Liquibase

### Security:
- JWT аутентификация, private/public ключи
- роли: CLIENT, DENTIST, ADMIN, MASTER(выдает/забирает админки, назначен через бд)
- OAuth - Google/Github (Google в тестовом режиме)

### Бизнес-логика:
- главные демонстрационные странички
- комментарии
- загрузка фотографии(!не сильно высокого качества)
- профиль -> разный в зависимости от роли
- timetable + запись через него
- ADMIN -> банит пользователей, удаляет комментарии, подтвержает/отклоняет стоматологов, создает процедуры
- MASTER - ничем не отличается от админа кроме возможности выдавать админки
- CLIENT - записывается на прием, пишет комментарии
- DENTIST - заполнение общедоступной информации о себе в профиле

# Требования к семестровой работе

## Обязательные требования

1. Семестровая работа – сайт, написанный с использованием Spring MVC Framework.
2. У сайта должна быть идея, обладающая новизной и актуальностью. Если сомневаетесь в сложности и новизне проекта, лучше подойдите-уточните. Либо же можно воспользоваться своей предыдущей семестровой и развить её.
   Сайт должен иметь удобный интерфейс.
3. Необходимо использовать HTML5, CSS3. CSS-препроцессоры не запрещаются, но нужно знать их основные принципы. Если используете CSS-фреймворки (Bootstrap и проч.), должны уметь пояснить, что за классы используете, особенно классы сетки.
4. Необходимо корректно работать с формами: проверка данных, защита от повторной отправки там, где это нужно.
5. Нужно использовать любой шаблонизатор, можно JSP. В коде видов нельзя напрямую вызывать Java-код. Должна быть развитая система шаблонов (свои теги или наследование шаблонов, разделение видов на несколько частей).
6. Сайт должен иметь аутентификацию, авторизацию, регистрацию (Spring Security).
7. Сайт должен быть защищён от атак, которые обсуждались в течение всего курса предмета (XSS, CSRF, SI, CORS).
- **XSS:**
  - на фронтенде: используюся {{...}} для экранирования + нигде не используется `v-html` директива
  - на бэкенде: в security filter chain - `X-XSS-Protection` (браузер будет блокировать рендеринг страницы, если обнаружит XSS-атаку), `Content-Security-Policy` (Ограничивает источники, с которых можно загружать скрипты)
- **CSRF:**
  - Access-токен в localStorage не уходит автоматически с запросами
  - Refresh-токен в HttpOnly-cookie уязвим для CSRF, но используется только на одном endpoint-e, для которого выборочно включена CSRF-защита.
- **SI:**
  - JPA/Hibernate по умолчанию предоставляет prepared statement
  - не используется конкатенация sql-запроса
- **CORS:**
  - настройка в CorsConfig
8. Сайт должен хранить данные в реляционной СУБД: MySQL, MSSQL, MariaDB или **PostgreSQL**. Можно ли использовать другие СУБД нужно уточнить лично. Использование In-Memory DB (H2 и проч) не допускается.
9. Для работы с СУБД необходимо использовать и Spring Data JPA, и JPA. То есть должны быть как и репозитории от Spring, так и самостоятельно написанные запросы с помощью JPQL/CriteriaBuilder.
- **СriteriaBuilder - динамическая фильтрация записей по временному диапазону**
- **JPA(не spring data) - CommentJpaRepository(Impl)**
- **все остальные репозитории - Spring Data Jpa (JPQL + native query + именновые методы)**
10. Система должна работать, как минимум с  пятью JPA сущностями. Должны быть связи M2M, O2M, O2O.
- **O2O: user_data <-> client, user_data <-> dentist, appointment <-> appointment-form**
- **O2M: user_data <-> user_credentials, specialization <-> procedure**
- **M2M: user_data <-> user_role**
11. Как минимум, для одной из сущностей должен быть реализован полностью CRUD: не обязательно в виде админки, но должны быть некие экшены контроллеров, которые вызывают эти методы. - **CRUD на сущность Procedure у пользователей ADMIN/MASTER**
12. Система должна быть построена по модели MVC, и следует придерживаться логики Controller->Service->Repository и тд.  Необходимо придерживаться принципов SOLID. Весь код должен быть корректно поделен на пакеты. Рекомендуется использовать DTO-, Request-, Forms-классы, где это уменьшает связность, абстрагирует архитектуру.
13. Проект должен быть основан на Spring Boot: нужно использовать стартеры, настройки и запускающий класс.
14. Все реализации требований должны вписываться в бизнес-логику и выполнение соответствующего кода должно быть возможно из-за действий пользователя.

## Требования к наполнению, наличию реализаций

1. Необходимо применить Javascript. Нужно использовать AJAX.
2. Все исключения, проблемы должны корректно обрабатываться: обычные экшены – приводить к отдачи самостоятельно оформленной веб-страницы, а AJAX-запросы получить JSON-ответ с информацией о проблеме. Не должно быть дефолтных страниц с ошибками от сервера приложений или Spring Boot.
3. Использование стороннего API, не используя специальную библиотеку для этого API, а самостоятельное описание запросов на уровне HTTP (например, библиотека okhttp, restTemplate). Примеры: вход или восстановление пароля через отправку смс, использование курсов валют для пересчёта стоимости корзины. Наличие простого информера для сайта типа вывода погоды не подходит! - **получение информации о праздничных днях в России через Calendarific API (RestTemplate + API ключ)**
4. Расширенное использование Spring Security. То есть полноценная работа с пользователем: закрытая часть сайта, аутентификация, регистрация.
5. Организация REST API хотя бы для одной сущности. - вся семестровая работа)
- Подключение и описание Swagger. - **при запуске http://localhost:8080/swagger-ui/index.html**
- А также написание тестов через http-файлы Idea или через Postman. - **http-файлы с тестами в src/test/recourses/http/...**
6. Использование конвертеров, в том числе и своих - **кастомные мапперы почти для каждой сущности(иногда Mapstruct), EncryptConverter для кодирования/декодирования полей с документами клиента в бд**
7. Логирование возникающих исключений. - **aspect на DEBUG логирование контроллеров, сервисов, репозиториев; кастомная настройка logback; логирование исключений в ЕxceptionHandler-ах**
8. Наличие 2 нестандартных методов для репозиториев Spring: самостоятельно написанных методов с использованием:
- @Query - **практически в любом jpa-репозитории есть метод с JPQL и с native-query**
- CriteriaBuiler - **запрос для динамической фильтрации appointment по диапазону дат**
  но не повторяющих функционал методов, описываемых в Spring Data JPA.
9. Один запрос с подзапросом - **в DentistRepository получение выборки стоматологов, чья специализация связана с конкретной процедурой**


## Сроки

Дедлайн досрочной сдачи: 24 мая. Можно получить +4 балла баллов сверх баллов семестровой работы при строгом выполнении всех требований.
Дедлайн сдачи: 14 июня.

## Разбалловка
При несоответствии каждому дополнительному требованию максимальные баллы уменьшаются на 20%.
Если обнаружено, что какой-то участок кода списан, то баллы списавшего и давшего списать аннулируются полностью.
Все уменьшения баллов целочисленные, с округлением в меньшую сторону.

1. Фронтэнд (вёрстка, дизайн, шаблоны, JS) – 3
2. Работа с базой (репозитории, 5 сущностей, M2M, O2M, O2O свои запросы) – 4
3. Архитектура (слои абстракций, взаимодействие модулей, шаблоны проектирования) – 4
4. Общие правила построения сайтов (упоминание контекста, защита от повторной отправки, проверки ввода, корректный вывод, обработка запроса и проч) – 6
5. Использование продвинутых техник/технологий, в т.ч. Spring (логгирование, правильное описание конфигураций, настройка окружения, конвертеров, централизованная обработка исключений и т.д.) – 7
6. Корректное использование API – 1
   Итого: 25 баллов

Пример: студент сдал работу без 2 дополнительных требований и у него было очень много проблем с фронтэндом. 60% максимальных баллов и вычет всех баллов за фронтэнд: (1-0.2*2)*(25-3) балла = 15 - 1.8 = 13.2 ≃ 13 баллов.

## Доп.задание:
Подключить oAuth-сервис без использование библиотеки, которая непосредственно решает эту задачу. Максимум: библиотека для отправки HTTP-запросов, генерации секретных кодов. Нужно реализовать функционал “войти через”.
+4 балла (но не более 25 суммарно)
